#!/usr/bin/env python3
# local pastebin
# writes files to /var/www/pb
# filenames are generated by hashing the file content to avoid duplicates

import random
import io
import os
import sys
import hashlib

adj = [ "Defiant", "Homeless", "Adorable", "Delightful", "Homely", "Quaint",
     "Adventurous", "Depressed", "Horrible", "Aggressive", "Determined",
     "Hungry", "Real", "Agreeable", "Different", "Hurt", "Relieved", "Alert",
     "Difficult", "Repulsive", "Alive", "Disgusted", "Ill", "Rich", "Amused",
     "Distinct", "Important", "Angry", "Disturbed", "Impossible", "Scary",
     "Annoyed", "Dizzy", "Inexpensive", "Selfish", "Annoying", "Doubtful",
     "Innocent", "Shiny", "Anxious", "Drab", "Inquisitive", "Shy", "Arrogant",
     "Dull", "Itchy", "Silly", "Ashamed", "Sleepy", "Attractive", "Eager",
     "Jealous", "Smiling", "Average", "Easy", "Jittery", "Smoggy", "Awful",
     "Elated", "Jolly", "Sore", "Elegant", "Joyous", "Sparkling", "Bad",
     "Embarrassed", "Splendid", "Beautiful", "Enchanting", "Kind", "Spotless",
     "Better", "Encouraging", "Stormy", "Bewildered", "Energetic", "Lazy",
     "Strange", "Black", "Enthusiastic", "Light", "Stupid", "Bloody",
     "Envious", "Lively", "Successful", "Blue", "Evil", "Lonely", "Super",
     "Blue-eyed", "Excited", "Long", "Blushing", "Expensive", "Lovely",
     "Talented", "Bored", "Exuberant", "Lucky", "Tame", "Brainy", "Tender",
     "Brave", "Fair", "Magnificent", "Tense", "Breakable", "Faithful", "Misty",
     "Terrible", "Bright", "Famous", "Modern", "Tasty", "Busy", "Fancy",
     "Motionless", "Thankful", "Fantastic", "Muddy", "Thoughtful", "Calm",
     "Fierce", "Mushy", "Thoughtless", "Careful", "Filthy", "Mysterious",
     "Tired", "Cautious", "Fine", "Tough", "Charming", "Foolish", "Nasty",
     "Troubled", "Cheerful", "Fragile", "Naughty", "Clean", "Frail", "Nervous",
     "Ugliest", "Clear", "Frantic", "Nice", "Ugly", "Clever", "Friendly",
     "Nutty", "Uninterested", "Cloudy", "Frightened", "Unsightly", "Clumsy",
     "Funny", "Obedient", "Unusual", "Colorful", "Obnoxious", "Upset",
     "Combative", "Gentle", "Odd", "Uptight", "Comfortable", "Gifted",
     "Old-fashioned", "Concerned", "Glamorous", "Open", "Vast", "Condemned",
     "Gleaming", "Outrageous", "Victorious", "Confused", "Glorious",
     "Outstanding", "Vivacious", "Cooperative", "Good", "Courageous",
     "Gorgeous", "Panicky", "Wandering", "Crazy", "Graceful", "Perfect",
     "Weary", "Creepy", "Grieving", "Plain", "Wicked", "Crowded", "Grotesque",
     "Pleasant", "Wide-eyed", "Cruel", "Grumpy", "Poised", "Wild", "Curious",
     "Poor", "Witty", "Cute", "Handsome", "Powerful", "Worrisome", "Happy",
     "Precious", "Worried", "Dangerous", "Healthy", "Prickly", "Wrong", "Dark",
     "Helpful", "Proud", "Dead", "Helpless", "Putrid", "Zany", "Defeated",
     "Hilarious", "Puzzled", "Zealous" ]
noun = ['Tony', 'Clive', 'Nigel', 'Barry', 'Jed', 'Touglas', 'Gary', 'Clown',
        'Horse', 'Dog', 'Cat', 'Haus', 'Horn', 'Worm', 'Gamer', 'Mike']

# totalCombinations = len(adj) * len(adj) * len(noun)
# print(f'{totalCombinations} total combinations')
# sys.exit(0)

def generateName(content):
    m = hashlib.sha1()
    m.update(bytes(content, encoding='utf-8'))
    # split the hash to get three array indexes
    digest = m.digest()
    i1 = int.from_bytes(digest[:4], byteorder='big') % len(adj)
    i2 = int.from_bytes(digest[4:8], byteorder='big') % len(adj)
    i3 = int.from_bytes(digest[8:12], byteorder='big') % len(noun)
    return f'{adj[i1]}{adj[i2]}{noun[i3]}'

io_stream = io.TextIOWrapper(sys.stdin.buffer, encoding='utf-8')
content = io_stream.read()
fileName = generateName(content)
filePath = os.path.join('/var/www/pb', fileName)
print(f'https://irc.alligatr.co.uk/pb/{fileName}')
if os.path.isfile(filePath):
    sys.exit(0)
fi = open(f'/var/www/pb/{fileName}', 'w', encoding='utf-8').write(content)
